spring.application.name=code-test

# --- H2 DataSource ---
spring.datasource.url=jdbc:h2:mem:codetest;MODE=MySQL;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# --- H2 Console ---
# [리뷰 57 - H2 Console 운영 환경 노출 (Critical)]
# 문제: 프로파일 구분 없이 모든 환경에 enabled=true → 운영 배포 시 /h2-console로 DB 접근 가능
# 원인: 개발 편의를 위해 추가 후 프로파일 분리 없이 방치
# 개선안: application-dev.properties에만 enabled=true, prod는 제거 (기본 false)
#         + Spring Security로 IP 화이트리스트(127.0.0.1) 추가
# 검증: curl https://production.com/h2-console → 404 확인
# 참고: 우아한형제들 기술블로그 - Spring Security 설정
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# --- JPA / Hibernate ---
# [리뷰 58 - ddl-auto=update 데이터 손실 위험 (Critical)]
# 문제: update 모드로 운영 배포 시 자동 스키마 변경
#       String price → Integer 타입 변경 시 "10,000원" → NULL로 데이터 유실
# 원인: Hibernate update 모드가 안전하다는 착각 (컬럼 추가만 안전, 타입 변경은 위험)
# 개선안: dev=create-drop, prod=validate + Flyway 마이그레이션 도입
# 검증: 컬럼 타입 변경 시 NULL 변환 건수 확인
# 참고: 토스 기술블로그 - Flyway를 이용한 DB 마이그레이션
spring.jpa.hibernate.ddl-auto=update

# [리뷰 59 - show-sql 성능/보안 문제 (High)]
# 문제: show-sql=true로 일 100만 요청 시 300만 SQL 로그(600MB) + 민감정보 노출
# 원인: 디버깅 용도로 추가 후 제거 안 함, System.out 동기 출력으로 성능 저하
# 개선안: false로 변경, dev에서는 logging.level.org.hibernate.SQL=DEBUG 사용
# 검증: 로그 크기 측정, PCI-DSS 위반 여부 확인
# 참고: NHN Cloud - Hibernate SQL 로깅 Best Practice
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

# [리뷰 60 - OSIV 커넥션 낭비 (High)]
# 문제: 기본값 true로 HTTP 요청 전체(100ms)에 커넥션 점유 → 실제 필요(50ms)의 2배 낭비
# 원인: Spring Boot 2.0+ 기본 설정 인식 부족
# 개선안: open-in-view=false + DTO 변환(리뷰 #3) + @Transactional 명시(리뷰 #13)
# 검증: 1000 TPS 필요 커넥션 100개 → 50개 감소 확인
# 참고: 김영한 - JPA 활용 2편, OSIV와 성능 최적화
# (현재 설정 없음, 기본값 true 사용 중)

# --- SQL init ---
spring.sql.init.mode=never

# [리뷰 61 - 성능 설정 누락 (Medium)]
# 문제: HikariCP pool-size=10, JPA 배치 미사용 → 100 TPS 처리 어려움
# 원인: Spring Boot 기본값 과신
# 개선안: maximum-pool-size=50, batch_size=50 설정
# 검증: 부하 테스트로 타임아웃 발생률 측정
# 참고: 우아한형제들 - HikariCP 커넥션 풀 설정하기
# (현재 모두 기본값 사용 중)

# [리뷰 66 - Properties 형식 사용 (Low)]
# 문제: 계층 구조 반복(spring.datasource.url, spring.datasource.driver-class-name...)
# 원인: 초기 프로젝트 생성 시 기본 선택
# 개선안: application.yml로 변경 (180줄 → 120줄, 프로파일 단일 파일 관리)
# 검증: YAML 변환 후 bootRun 정상 작동 확인
# 참고: Spring 공식 문서 - Externalized Configuration
